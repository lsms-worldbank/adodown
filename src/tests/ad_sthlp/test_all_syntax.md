# Title

__iebaltab__ - produces balance tables with multiple groups or treatment arms

# Syntax

__iebaltab__ _balance_varlist_ [if] [in] [weight], __**group**var__(_varname_) [ _column/row_options_ _estimation_options_ _stat_display_options_ _labe/notel_options_ _export_options_ _latex_options_ ]

## Required options

| _options_ | Description |
|-----------|-------------|
| __**group**var__(_varname_) | Variable indicating the groups (ex. treatment arms) to test across |

## Column and row option

| _options_ | Description |
|-----------|-------------|
| __**co**ntrol__(_groupcode_) | Indicate a single group that all other groups are tested against. Default is all groups are tested against each other |
| __**or**der__(_groupcodelist_) | Manually set the order the groups appear in the table. Default is ascending. See details on _groupcodelist_ below |
| __**tot**al__ | Include descriptive stats on all observations included in the table |
| __onerow__ | Write number of observations (and number of clusters if applicable) in one row at the bottom of the table |

# Description

`iebaltab` is a command that generates balance tables (difference-in-means tables).

See the _Estimation/Statistics Definitions_
section below for a detailed documentation of what statistics this command
calculates and how they are calculated.

# Options

__**or**der__( _group_codelist_ ) manually sets the column order of the groups in the table. _group_codelist_ may
be any or all of the values in the group variable specified in `groupvar()`.

__**tot**al__ includes a column with descriptive statistics on the full sample.
This column still exclude observations with missing values
in `groupvar()` ,`robust`, `cluster _clustervar_` or `bootstrap`.
See the estimation definition section for exact definitions on how these

## Statistics display options

__stats__(_stats_string_)
indicates which statistics to be displayed in the table.
The _stats_string_ is expected to be on this format (where at least one of the sub-arguments `desc`, `pair`, `f` and `feq` are required):

```
stats(desc(descstats) pair(pairstats) f(fstats) feq(feqstats))
```

The table below lists the valid values for
_descstats_, _pairstats_, _fstats_ and _feqstats_.
See the estimation definition section
for exact definitions of these values and how they are estimated/calculated.

| Type | Options
|-----------|-------------|
| _descstats_ | `se` `var` `sd` |
| _pairstats_ | `diff` `beta` `t` `p` `nrmd` `nrmb` `se` `sd` `none` |
| _fstats_ | `f` `p` |
| _feqstats_ | `f` `p` |

__texcolwidth__(_string_) limits the width of table's first column
so that a line break is added when a variable's name or label is too long.
{it:string} must consist of a numeric value with one of the following units:
"cm", "mm", "pt", "in", "ex" or "em".
For more information on these units,
[check LaTeX length's manual](https://en.wikibooks.org/wiki/LaTeX/Lengths).

# Estimation/statistics definitions

This section details the regressions that are used to estimate
the statistics displayed in the balance tables generated by this command.
For each test there is a "basic form" example to highlight the core of the test,
and an "all options" example that shows exactly how all options are applied.
Here is a glossary for the terms used in this section:

| Term | Definition |
|-----------|-------------|
| _balance variable_ | The variables listed as _balancevarlist_ |
| _groupvar_ | The variable specified in `groupvar()` |
| _groupcode_ | Each value in _groupvar_ |
| _testpair_ | Combination of _group codes_ to be used in pair wise tests |
| _tp_dummy_ | A dummy variable where the first _group code_ in a _test pair_ has the value 1 and the second _group code_ has the value 0, and all other observations has missing values |

Each section below has a table that shows how the stats are estimated/calculated for each type of statistics. This is what each column means.
A star (*) in the _Stat_ column indicate that is the optional statistics displayed by default if the `stats()` option is not used.
The _Display option_ column shows what sub-option to use in `stats()` to display this statistic.
The _Mat col_ column shows what the column name in the result matrix for the column that stores this stat. See more about the result matrices in the _Result matrices_ section.

| Stat | Display option | Mat col | Estimation/calculation |
| --- | --- | --- | --- |
| # obs | Always displayed | `n_gc` | `e(N)` after `reg` |
| cluster | Displayed if used | `cl_gc` | `e(N_clust)` after `reg` |
| mean | Always displayed | `mean_gc` | `_b[cons]` after `reg` |
| se * | `stats(desc(se))` | `se_gc` | `_se[cons]` after `reg` |
| var | `stats(desc(var))` | `var_gc` | `e(rss)/e(df_r)` after `reg` |
| sd | `stats(desc(sd))` | `sd_gc` | `_se[_cons]*sqrt(e(N))` after `reg` |

# Examples

## Example 1

```
sysuse census
gen group = runiform() < .5
iebaltab pop medage, groupvar(group) browse
browse
```

In the example above, Stata's built in census data is used.
First a dummy variable is created at random.
Using this random group variable a balance table is created testing for
differences in _pop_ and _medage_.
By using `browse` the data in memory is replaced with the table so that
the table can be used in the browse window.
You most likely never should use the `browse` option in your final code
but it is convenient in examples like this and when first testing the command.
See examples on how to save the table to a file on disk below.

For statistics where the direction matters (for example _diff_ or _beta_)
the order is changed so that the test is (_other_group_ - _control_)
such that a positive value indicates that the other group has a higher
mean in the balance variable.

## Example 5

```
sysuse census
local outfld "path/to/folder"
iebaltab pop medage, groupvar(region) control(4) ///
  stats(desc(var) pair(p)) replace ///
  savecsv("`outfld'/iebtb.csv") savexlsx("`outfld'/iebtb.xlsx") ///
  savetex("`outfld'/iebtb.tex") texnotefile("`outfld'/iebtb_note.tex")
```

This example shows how to export the tables to the three formats supported.
CSV, Excel and LaTeX.
To run this code you must update the path _"path/to/folder"_ to point
to a folder on your computer where the tables can be exported to.
It makes it easier to align the note with the table when LaTeX adjust the size
of the table to fit a page.

```
\begin{table}
  \centering
  \caption{Balance table}
  \begin{adjustbox}{max width=\textwidth}
    \begin{threeparttable}[!h]
	  \input{./balancetable.tex}
	  \begin{tablenotes}[flushleft]
	    \item\hspace{-.25em}\input{./balancetable_note.tex}
	  \end{tablenotes}
    \end{threeparttable}
  \end{adjustbox}
\end{table}
```

You can also see the code, make comments to the code, see the version
history of the code, and submit additions or edits to the code through [GitHub repository](https://github.com/worldbank/ietoolkit) for `ietoolkit`.
